---
import FieldFormRowAccordion from "../../components/FieldFormRowAccordion.astro"
let collection:any = null;
let field:any = null;
let length:any = null;
let parentName:any = null;
let parentField:any = null;
let name:any = null;
let stage:any = null;

if (Astro.request.method === "POST") {
    const formData = await Astro.request.formData();
    length = formData.get("length")
    parentName = formData.get("parentName");
    name = formData.get("name");
    parentField = formData.get("parentField");
    collection = formData.get("collection")
    field = formData.get("field")
    stage = formData.get("stage")

    collection = JSON.parse(collection)
    field = JSON.parse(field);
    stage = JSON.parse(stage);
}
---

{
    field?.fields.map((fieldItem:any) => (
        <FieldFormRowAccordion stage={stage} parentName={parentName} name={name} itemIndex={length} parentField={field} collection={collection} field={fieldItem}></FieldFormRowAccordion>
    ))
}